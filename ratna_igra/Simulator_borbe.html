<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta http-equiv="X-UA-Compatible" content="ie=edge">
    <link rel="stylesheet" type="text/css" href="css/war.css">
    <title>Simulacija borbe</title>    
</head>
<body>    
    <div class="Main">
        <div class="MainWrap">
            <p id="winR">Red wins!</p>
            <p id="winB">Blue wins!</p>
            <p id="tieGame">Tie game!</p>
            <div class="container">
                <div class="redPlayer"></div>
                <div><button type="button" id="borba">Fight</button></div>
                <div class="bluePlayer"></div>
            </div>    
        </div>
    </div>
    <button id="heal">heal</button>
    <script>
        class Vojska {
            constructor(name) {
               this.name = name;
               this.health = 100;  
               this.attack = this.attackPower();
            }        
            attackPower() {
                if(this instanceof Pesadija) {
                    return Math.floor(Math.random() * (20-10) + 10);
                } else if(this instanceof Avijacija) {
                    return Math.floor(Math.random()*(50-25) + 25);  
                } else if(this instanceof Mornarica) {
                    return Math.floor(Math.random()*(60-30) + 30); 
                } else {
                    return 10;
                } 
            }   
            set primljenUdarac(attack) {
                this.health -= attack;
            }
            set healTroops(healArmy) {
                if(this.health + healArmy > 100) {
                    this.health = 100;
                } else {
                    this.health += healArmy;
                }
            }
            set increaseAttack(attack) {
                this.health -= attack * 1.2;
            }
        }
        class Pesadija extends Vojska {
            constructor(name, attack) {
                super(name);   
                //this.attack = Math.floor(Math.random() * (30-15) + 15);
            }    
        }
        class Avijacija extends Vojska {
            constructor(name, attack) {
                super(name);  
                //this.attack = Math.floor(Math.random()*(60-30) + 30);                           
            }        
        }   
        class Mornarica extends Vojska {
            constructor(name, attack) {
                super(name);       
            }        
        }               
            let playerBlue = [];
            let playerRed = []   

            for(i = 0; i < 3; i++){
                let pesadinacR = new Pesadija('pesadinacR' + i);                
                let pilotR = new Avijacija('pilotR' + i);
                let pesadinacB = new Pesadija('pesadinacB' + i);
                let pilotB = new Avijacija('pilotB' + i);
                playerRed.unshift(pesadinacR);
                playerBlue.unshift(pesadinacB);
                playerRed.push(pilotR);
                playerBlue.push(pilotB);
            }   
            for(i = 0; i < 3; i++){
                let mornarR = new Mornarica('mornarR' + i);
                let mornarB = new Mornarica('mornarB' + i);
                playerRed.push(mornarR);
                playerBlue.push(mornarB);
            }
            let redPlayer = document.querySelector('.redPlayer');
            let bluePlayer = document.querySelector('.bluePlayer'); 
            for (i = 0; i < 9; i++) {
                let divR = document.createElement('div');
                let divB = document.createElement('div');
                let divBarR = document.createElement('div');
                let divBarB = document.createElement('div');
                let barR = document.createElement('div');
                let barB = document.createElement('div');
                barR.className = 'bar';
                barB.className = 'bar';
                divBarR.className = 'barR' + i;
                divBarB.className = 'barB' + i;
                divR.className = 'divRed' + i;
                divBarR.style.width = '100%';
                divBarR.style.height = '100%';
                divBarR.style.backgroundColor = '#3196a7';
                divB.className = 'divBlue' + i;
                divBarB.style.width = '100%';
                divBarB.style.height = '100%';
                divBarB.style.backgroundColor = '#3196a7';
                redPlayer.appendChild(divR);
                redPlayer.appendChild(barR);
                barR.appendChild(divBarR);
                bluePlayer.appendChild(divB);
                bluePlayer.appendChild(barB);
                barB.appendChild(divBarB);
            }  
            let heal = document.getElementById('heal'); 
            let borba = document.getElementById('borba');           
           
            borba.addEventListener('click', napad);
            function napad() {
                let a = 0;  
                
                for(i = 0; i < 9; i++) {                    
                    let random = Math.floor(Math.random() * 9);                    
                    playerRed[i].primljenUdarac = playerBlue[random].attack;
                    playerBlue[i].primljenUdarac = playerRed[random].attack;
                    let healthB = document.querySelector('.barB' + i);
                    var healthR = document.querySelector('.barR' + i);
                    let divB = document.querySelector('.divBlue' + i);
                    let divR = document.querySelector('.divRed' + i); 

                    if(playerBlue[i].health > 0) {
                        healthB.style.width = playerBlue[i].health + '%';
                    } 
                    if(playerRed[i].health > 0) {
                        healthR.style.width = playerRed[i].health + '%';
                    }
                    if(playerBlue[i].health <= 0 && divB != null) {
                        divB.className = 'dead';
                        healthB.style.width = '0%';
                        playerBlue[i].attack = 0;
                    }   
                    if(playerRed[i].health <= 0 && divR != null) {                        
                        divR.className = 'dead';
                        healthR.style.width = '0%';
                        playerRed[i].attack = 0;
                    }
                    /* if(playerRed[i].health <= 0) {
                           playerRed.splice(i, 1); 
                        } */
                }                       
                                                        
                  let alive = playerBlue.map(al => {                    
                        if(al.attack != 0){
                         return a++;                                              
                        } else {
                          return false;
                        }                      
                    });                
                   
                console.log(alive);    
                console.log(playerRed);   
                console.log(playerBlue); 

                /*let bar1 = document.querySelector('.bar1');
                if(!playerRed[3] == false && playerRed[3].health < 100 ) {
                bar1.style.width = playerRed[3].health + '%';
                } else {
                    bar1.style.width = '0%';
                    console.log(`player dead`)
                }*/   
                let redVictory = document.getElementById("winR"); 
                let blueVictory = document.getElementById("winB"); 
                let tie =  document.getElementById("tieGame");
                redVictory.style.zIndex = "-1";
                blueVictory.style.zIndex = "-1";
                tie.style.zIndex = "-1";
                size = 10;
                function remove(color) {
                    setTimeout(function(){
                        color.style.fontSize = '0px';   
                        }, 1200);
                    }
                function intervalCondition(winner, text) {
                    if(size == 200) {
                            clearInterval(winner);
                            remove(text);
                        } else {
                            size++;
                            text.style.zIndex = "2";
                            text.style.fontSize = size + 'px';
                        }
                    }   
                if(playerRed.every(x => x.health <=0) && playerBlue.some(y => y.health > 0)) {
                    let blueWins = setInterval(blue, 10);
                    function blue() {
                        intervalCondition(blueWins, blueVictory);
                    }                    
                } else if(playerBlue.every(y => y.health <= 0) && playerRed.some(x => x.health > 0)) {
                    let redWins = setInterval(red, 10);
                    function red() {
                        intervalCondition(redWins, redVictory);
                    }                    
                } else if(playerRed.every(x => x.health <=0) && playerBlue.every(y => y.health <= 0)){
                    let tieG = setInterval(equal, 10);
                    function equal() {
                        intervalCondition(tieG, tie);
                    }                    
                } 
                function healthw() {
                    return function() {   
                        for(i=0;i<3;i++) { 
                            let row = i*3; 
                            if(playerRed[row].attack == 0) {   
                                console.log(`no heal`)
                             } else if(playerRed[row].attack > 0) {
                                    playerRed[row].healTroops = 10;                                        
                                    document.querySelector('.barR' + row).style.width = playerRed[row].health + '%';
                            }
                        }
                    } 
                }
                    
                
                heal.addEventListener('click', healthw());
               
            } 
           
            
                   
            /*let red = document.querySelector('.divRed1');
            let redWrap = document.createElement('div');
            redWrap.className = 'target';
            red.appendChild(redWrap);*/           
            
    </script>
</body>
</html>